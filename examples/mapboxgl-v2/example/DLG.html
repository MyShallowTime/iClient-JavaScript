<!DOCTYPE html>
<html lang="zh">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="initial-scale=1.0, user-scalable=no, width=device-width">
  <title>DLG_I49</title>
  <style>
    body {
      margin: 0;
      padding: 0;
    }

    #map {
      position: absolute;
      top: 0;
      bottom: 0;
      width: 100%;
    }
  </style>
</head>

<body>
  <div id="map"></div>
  <script type="text/javascript" src="https://iclient.supermap.io/web/libs/mapbox-gl-js/1.13.2/mapbox-gl.js"></script>
  <script type="text/javascript" src="../libs/mapboxgl/iclient-mapboxgl.js"></script>
  <script>
    const url = "https://iserver.supermap.io/iserver/services/map-china400/rest/maps/China";
    const map = new mapboxgl.Map({
      container: 'map',
      style: {
        "sources": {
          "DLGI49": {
            "tiles": ["http://172.16.14.80:8090/iserver/services/map-DLG_100W/restjsr/v1/vectortile/maps/DLGI49/tiles/{z}/{x}/{y}.mvt"],
            "type": "vector"
          }
        },
        "center": [
          110.66049081338542,
          34.055934678686114
        ],
        "name": "DLGI49",
        "layers": [],
        "zoom": 8.00721072893464,
        "version": 8
      }
    });

    // 加载符号
    const loadSymbol = async (symbolId) => {
      await map.loadSymbol(symbolId, (_err, newSymbol) => {
        map.addSymbol(symbolId, newSymbol);
      });
    }

    // 创建行政界线-线图层
    const createBOULLayer = (value, symbolId) => {
      map.addLayer({
        "filter": [
          "all",
          [
            "==",
            "$type",
            "LineString"
          ],
          [
            "==",
            "GB",
            value
          ]
        ],
        "id": `BOUL@DLG_100W_unique_${value}_0(0_24)`,
        "source": "DLGI49",
        "source-layer": "BOUL@DLG_100W",
        "type": "line",
        "symbol": symbolId
      });
    }

    // 创建水系-线图层
    const createHYDLLayer = (value, symbolId) => {
      map.addLayer({
        "id": `HYDL@DLG_100W_unique_${value}_0(0_24)`,
        "source": "DLGI49",
        "source-layer": "HYDL@DLG_100W",
        "type": "line",
        "filter": [
          "all",
          [
            "==",
            "GB",
            value
          ],
          [
            ">",
            "NAME",
            ""
          ]
        ],
        "symbol": symbolId
      });
    }

    // 创建公路-线图层
    const createLRDLLayer = (value, symbolId) => {
      map.addLayer({
        "filter": [
          "all",
          [
            "==",
            "$type",
            "LineString"
          ],
          [
            "==",
            "GB",
            value
          ],
          [
            "any",
            [
              "==",
              "RTEG",
              "一"
            ],
            [
              "==",
              "RTEG",
              "高"
            ]
          ]
        ],
        "id": `LRDL@DLG_100W_unique_${value}_0(0_24)`,
        "source": "DLGI49",
        "source-layer": "LRDL@DLG_100W",
        "type": "line",
        "symbol": symbolId
      });
    }

    map.on('load', async () => {
      await loadSymbol("line-63020004");
      createBOULLayer(630200, "line-63020004");
      await loadSymbol("line-64020004");
      createBOULLayer(640200, "line-64020004");
      await loadSymbol("line-21010104");
      createHYDLLayer(210101, "line-21010104");
      await loadSymbol("line-42010104");
      createLRDLLayer(420101, "line-42010104");
      await loadSymbol("line-42020104");
      createLRDLLayer(420201, "line-42020104");
      await loadSymbol("line-42020204");
      createLRDLLayer(420202, "line-42020204");
    })
  </script>
</body>

</html>